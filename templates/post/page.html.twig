{% extends "base.html.twig" %}

{% block title %}
    Пост
{% endblock %}

{% block body %}
    <main>
        <article>
            <div class="post-header">

                {% if post.categoryTitle == "Технологии" %}
                    <span class="post-category category-tech">
                            Технологии
                        </span>
                {% elseif post.categoryTitle == "Жизнь" %}
                    <span class="post-category category-life">
                            Жизнь
                        </span>
                {% elseif post.categoryTitle == "Путешествия" %}
                    <span class="post-category category-travel">
                            Путешествия
                        </span>
                {% elseif post.categoryTitle == "Еда" %}
                    <span class="post-category category-food">
                            Еда
                        </span>
                {% endif %}

                <h1 class="post-title">
                    {{ post.title }}
                </h1>
                <div class="post-meta">
                    <span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        {{ post.createdAt|date("d.m.Y H:i") }}
                    </span>
                </div>
            </div>

            <div class="post-content">
                {{ post.text }}
            </div>

            {% if not app.user.isBlocked %}
                <div class="post-actions">
                    <form method="POST" action="{{ path("postPostLike", {"post_id":  post.id}) }}">
                        <button class="post-btn" type="submit">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                 stroke-width="2"
                                 stroke-linecap="round" stroke-linejoin="round">
                                <path
                                    d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                            </svg>

                            Нравится ({{ post.likesCount }})
                        </button>
                    </form>
                </div>
            {% endif %}

            <div class="comments-section">
                <h2 class="comments-title">Комментарии ({{ post.commentsCount }})</h2>

                {% if not app.user.isBlocked %}
                    <form class="comment-form" method="POST"
                          action="{{ path("postPostComment", {"post_id": post.id}) }}">
                        <textarea name="text" placeholder="Напишите ваш комментарий..." required></textarea>

                        <button type="submit" class="post-btn">
                            Отправить
                        </button>
                    </form>
                {% endif %}

                {% for comment in comments %}
                    {% if comment.parentId is null %}
                        {% include 'includes/comment.html.twig' with {comments: comments, comment: comment, post_id: post.id} only %}
                    {% endif %}
                {% endfor %}
            </div>
        </article>
    </main>

    <script>
        document.querySelectorAll('.reply-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const replyForm = btn.closest('.comment').querySelector('.reply-form');
                replyForm.classList.toggle('active');
            });
        });
    </script>
{% endblock %}
